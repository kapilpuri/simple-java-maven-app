

pipeline {

  agent any

  

  tools {
     maven 'maven-3.6.0'

    jdk 'java1.8.0'

    

    }

    

    stages {              
               
        stage('BUILD') {

          steps {
              sh "mvn -B -DskipTests clean package"

              }
              
              }
          stage('Test') {
              steps {
                    sh "mvn test"
                    }
                 post {
                      always {
                            junit 'target/surefire-reports/*.xml'
                            }
                           }
                         }
                  stage ('clone')  {
                  
                    steps {
                        git branch: 'master', url: "https://github.com/kapilpuri/simple-java-maven-app.git"
                        
                        }
                       }
                       
                    stage ('Artifactory configuration')   {
                    
                      steps {
                            rtserver (
                                    id: "ARTIFACTORY",
                                    url: "http://34.221.84.5:8081/artifactory",
                                    credentialsId: "Devops"
                                    
                                  )
                             rtMavenDeployer (
                                     id: "MAVEN_DEPLOYER",
                                     serverId: "ARTIFACTORY",
                                     releaseRepo: "libs-release-repo",
                                     snapshotRepo: "libs-snapshot-repo"
                                 )
                                 
                              rtMavenResolver (
                                      id: "MAVEN_RESOLVER",
                                      serverId: "ARTIFACTORY",
                                      releaseRepo: "libs-release",
                                      snapshotRepo: "libs-snapshot"
                         
                                 )
                         }
                         }
                stage ('EXEC Maven') {
                        steps {
                                rtMavenRun(
                                    tool:'maven-3.6.0',
                                    pom: 'pom.xml',
                                    deployerId: 'MAVEN_DEPLOYER',
                                    resolverId: 'MAVEN_RESOLVER'
                              )
                              }
                              }
                              
                 stage ('Publish build info') {
                          steps {
                              rtPublishBuildInfo (
                                    serverId: "ARTIFACTORY_SERVER"
                                   )
                                 }
                              }
                                    
                                
                
                         
               stage('Deploy') {
                      steps {
                           // sh '.jenkins/scripts/deliver.sh'
                          // sh 'java -jar target/my-app-1.0-SNAPSHOT.jar'
                          sh 'scp -o StrictHostKeyChecking=no -i /tmp/MARS_POC.pem target/my-app-1.0-SNAPSHOT.jar centos@34.216.127.228:/home/centos'
                           }
                        }
                       
             }

            }

           

              
